require.config({baseUrl:"js",shim:{openlayers:{exports:"OpenLayers"},jquerytouch:{deps:["jqueryui"],exports:"$"}},paths:{openlayers:"openlayers/ol-debug",geocoderjs:"geocoder/geocoder",jquerytouch:"jquery-ui-touch-punch/jquery-ui-touch-punch.min"}}),define(["jquerytouch","core/notification","core/str","openlayers","jqueryui","core/ajax","geocoderjs","core/templates"],function(a,b,c,d,e,f,g,h){var i={edittreasurehunt:function(c,e,h,i){function j(b,c,d,e,f,g){var h,i=a(b).get([d]),j=a(i).attr("roadid");h=Math.abs(a(i).index('li[roadid="'+j+'"]')-c),a(i).attr("noriddle",h),a(i).find(".sortable-number").text(h),a(i).hasClass("ui-selected")&&(S=h),J(parseInt(a(i).attr("riddleid")),h,parseInt(a(i).attr("roadid")),e,f,g)}function k(a,b,c){var d=a.get("riddleid"),e=c.getFeatureById(d);e||(e=b.getFeatureById(d).clone(),e.setId(d),c.addFeature(e)),"empty"===e.get("idFeaturesPolygons")?(e.setProperties({idFeaturesPolygons:""+a.getId()}),w(d)):e.setProperties({idFeaturesPolygons:e.get("idFeaturesPolygons")+","+a.getId()}),e.getGeometry().appendPolygon(a.getGeometry())}function l(a,b,c,e){a.forEach(function(a){var f,g=a.get("riddleid"),h=c.getFeatureById(g),i=new d.Collection;h||(h=b.getFeatureById(g).clone(),h.setId(g),c.addFeature(h));var j=h.getGeometry();f=h.get("idFeaturesPolygons").split(",");for(var k=0,l=f.length;l>k;k++)i.push(e.getSource().getFeatureById(f[k]).getGeometry().clone());j.setPolygons(i.getArray())})}function m(a,b,c,e){a.forEach(function(a){var f,g,h=a.get("riddleid"),i=c.getFeatureById(h),j=new d.Collection;i||(i=b.getFeatureById(h).clone(),i.setId(h),c.addFeature(i));var k=i.getGeometry();f=i.get("idFeaturesPolygons").split(",");for(var l=0,m=f.length;m>l;l++)f[l]!=a.getId()?j.push(e.getSource().getFeatureById(f[l]).getGeometry().clone()):g=l;k.setPolygons(j.getArray()),k.getPolygons().length?(f.splice(g,1),i.setProperties({idFeaturesPolygons:f.join()})):(i.setProperties({idFeaturesPolygons:"empty"}),v(h))})}function n(a){var b=a.get("noriddle");return isNaN(b)||(ea.getText().setText(""+b),da.getText().setText(""+b)),$[a.getId()]?[ea]:[da]}function o(c){var e=f.call([{methodname:"mod_treasurehunt_fetch_treasurehunt",args:{treasurehuntid:c}}]);e[0].done(function(c){if(console.log("json: "+c.treasurehunt.riddles+c.treasurehunt.roads),c.status.code)b.alert("Error",c.status.msg,"Continue");else{var e,f=c.treasurehunt.riddles,g=c.treasurehunt.roads,h=new d.format.GeoJSON,i=JSON.parse(g);i.constructor!==Array&&a.extend(W.roads,i);for(var j in W.roads)W.roads.hasOwnProperty(j)&&(r(W.roads[j].id,W.roads[j].name,W.roads[j].blocked),e=new d.layer.Vector({source:new d.source.Vector({projection:"EPSG:3857"}),updateWhileAnimating:!0,style:n}),W.roads[j].vector=e,ga.addLayer(e));Y.addFeatures(h.readFeatures(f,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"})),Y.getFeatures().forEach(function(a){null===a.getGeometry()&&a.setGeometry(new d.geom.MultiPolygon([]));for(var b=a.getGeometry().getPolygons(),c="empty",e=a.getId(),f=a.get("roadid"),g=a.get("noriddle"),h=a.get("name"),i=a.get("description"),j=W.roads[f].blocked,k=0;k<b.length;k++){var l=new d.Feature(a.getProperties());l.setProperties({riddleid:e});var m=b[k];l.setGeometry(m),l.setId(_),c=0===k?_:c+","+_,_++,W.roads[f].vector.getSource().addFeature(l)}a.setProperties({idFeaturesPolygons:""+c}),q(e,f,g,h,i,j),0===b.length&&v(e)}),u();for(var j in W.roads)if(W.roads.hasOwnProperty(j)){T=j,W.roads[T].blocked?A():z(),H(T,W.roads[T].vector,ga);break}}}).fail(function(a){console.log(a),b.exception(a)})}function p(a,b){a.forEach(function(a){b.getSource().removeFeature(a)}),a.clear()}function q(b,c,d,e,f,g){if(a('#riddleList li[riddleid="'+b+'"]').length<1){var h=a('<li riddleid="'+b+'" roadid="'+c+'" noriddle="'+d+'"/>').appendTo(a("#riddleList"));h.addClass("ui-corner-all").append("<div class='nameRiddle'>"+e+"</div>").append("<div class='modifyRiddle'><span class='ui-icon ui-icon-pencil'></span><span class='ui-icon ui-icon-info' data-id='#dialoginfo"+b+"'><div id='dialoginfo"+b+"' title='"+e+"'>"+f+"</div></span></div>"),g?h.addClass("blocked").prepend("<div class='nohandle riddle_valid'><span class='ui-icon ui-icon-locked'></span><span class='sortable-number'>"+d+"</span></div>"):(h.prepend("<div class='handle riddle_valid'><span class='ui-icon ui-icon-arrowthick-2-n-s'></span><span class='sortable-number'>"+d+"</span></div>"),h.children(".modifyRiddle").prepend("<span class='ui-icon ui-icon-trash'></span>")),a("#dialoginfo"+b).dialog({maxHeight:500,autoOpen:!1})}else console.log("El li con "+b+" no ha podido crearse porque ya existia uno")}function r(b,c,d){if(a('#roadList li[roadid="'+b+'"]').length<1){var e=a('<li roadid="'+b+'" blocked="'+d+'"/>').appendTo(a("#roadList"));e.addClass("ui-corner-all").append("<div class='roadname'>"+c+"</div>").append("<div class='modifyRoad'><span class='ui-icon ui-icon-trash'></span><span class='ui-icon ui-icon-pencil'></span></div>")}}function s(b){var c=a('#roadList li[roadid="'+b+'"]');if(c.length>0){var d=a('#riddleList li[roadid="'+b+'"]');c.remove(),d.remove()}}function t(b,c,d,e){var f=a('#riddleList li[riddleid="'+b+'"]');if(f.length>0){var g=f.attr("roadid"),h=f.index('li[roadid="'+g+'"]');f.remove();for(var i=a("#riddleList").children('li[roadid="'+g+'"]'),k=a(i).length,l=0;h-1>=l;l++)j(i,k,l,c,d,e)}}function u(){a("#riddleList li").sort(function(b,c){var d=parseInt(a(b).attr("noriddle")),e=parseInt(a(c).attr("noriddle"));return e>d?1:d>e?-1:0}).appendTo(a("#riddleList"))}function v(b){var c=a('#riddleList li[riddleid="'+b+'"]');c.children(".handle").addClass("riddle_invalid").removeClass("riddle_valid"),c.children(".modifyRiddle").append("<span class='ui-icon ui-icon-alert' data-id='#dialogalert'/>")}function w(b){var c=a('#riddleList li[riddleid="'+b+'"]');c.children(".handle").addClass("riddle_valid").removeClass("riddle_invalid"),c.find(".ui-icon-alert").remove()}function x(){a("#removeFeature").button("option","disabled",!1)}function y(){a("#removeFeature").button("option","disabled",!0)}function z(){a("#addRiddle").button("option","disabled",!1)}function A(){a("#addRiddle").button("option","disabled",!0)}function B(){var b=a("#edition").find("input:radio");b.attr("checked",!1).button("refresh"),b.button("option","disabled",!0),ia.setActive(!1),ha.setActive(!1)}function C(){a("#edition").find("input:radio").button("option","disabled",!1)}function D(){a("#saveRiddle").button("option","disabled",!1)}function E(){a("#saveRiddle").button("option","disabled",!0)}function F(a,b){var c=500,e=a.getView(),f=a.getSize(),g=d.animation.pan({duration:c,source:e.getCenter()}),h=d.animation.zoom({duration:c,resolution:e.getResolution()});a.beforeRender(g,h),e.fit(b,f)}function G(a,b){var c=500,e=a.getView(),f=d.animation.pan({duration:c,source:e.getCenter()}),g=d.animation.zoom({duration:c,resolution:e.getResolution()});a.beforeRender(f,g),e.setCenter(b)}function H(b,c,e){a("#riddleList li").removeClass("ui-selected").hide(),a("#riddleList li[roadid='"+b+"']").show(),a("#roadList li[roadid='"+b+"']").addClass("ui-selected"),e.getLayers().forEach(function(a){a instanceof d.layer.Vector&&a.setVisible(!1)}),c.setVisible(!0),c.getSource().getFeatures().length>0&&F(e,c.getSource().getExtent())}function I(a,b,c,d,e,f){b.getSource().clear(),d.clear(),$={};var g=e.getFeatureById(c);if(!g&&(g=f.getFeatureById(c),!g))return void a.changed();if("empty"===g.get("idFeaturesPolygons"))return void a.changed();for(var h=g.get("idFeaturesPolygons").split(","),i=0,j=h.length;j>i;i++)b.getSource().addFeature(a.getSource().getFeatureById(h[i]).clone()),$[h[i]]=!0;b.getSource().getFeatures().length&&F(ga,b.getSource().getExtent())}function J(a,b,c,d,e,f){var g,h=d.getFeatureById(a);if(h||(h=e.getFeatureById(a).clone(),h.setId(a),d.addFeature(h)),h.setProperties({noriddle:b}),"empty"!==h.get("idFeaturesPolygons")){g=h.get("idFeaturesPolygons").split(",");for(var i=0,j=g.length;j>i;i++)f.getSource().getFeatureById(g[i]).setProperties({noriddle:b})}}function K(a,b){var c="editriddle.php?cmid="+b+"&id="+a;window.location.href=c}function L(a,b){var c="editriddle.php?cmid="+b+"&roadid="+a;window.location.href=c}function M(a,b){var c="editroad.php?cmid="+b+"&id="+a;window.location.href=c}function N(a){var b="editroad.php?cmid="+a;window.location.href=b}function O(a,c,d,e,g){var h=f.call([{methodname:"mod_treasurehunt_delete_road",args:{roadid:a,treasurehuntid:e,lockid:g}}]);h[0].done(function(e){if(console.log(e),e.status.code)b.alert("Error",e.status.msg,"Continue");else{s(a),ga.removeLayer(W.roads[a].vector),delete W.roads[a];for(var f=d.getFeatures(),g=0;g<f.length;g++)if(a===f[g].get("roadid")){var h=c.getFeatureById(f[g].getId());h&&c.removeFeature(h),d.removeFeature(f[g])}B()}}).fail(function(a){console.log(a),b.exception(a)})}function P(a,c,d,e,g,h){var i=f.call([{methodname:"mod_treasurehunt_delete_riddle",args:{riddleid:a,treasurehuntid:g,lockid:h}}]);i[0].done(function(f){if(console.log(f),f.status.code)b.alert("Error",f.status.msg,"Continue");else{var g,h=!1,i=c.getFeatureById(a);if(t(a,c,d,e),i?("empty"!==i.get("idFeaturesPolygons")&&(h=i.get("idFeaturesPolygons").split(",")),c.removeFeature(i)):(i=d.getFeatureById(a),"empty"!==i.get("idFeaturesPolygons")&&(h=i.get("idFeaturesPolygons").split(",")),d.removeFeature(i)),h)for(var j=0,k=h.length;k>j;j++)g=e.getSource().getFeatureById(h[j]),e.getSource().removeFeature(g)}}).fail(function(a){console.log(a),b.exception(a)})}function Q(a,c,e,g,h,i){var j=new d.format.GeoJSON,k=a.getFeatures(),l=j.writeFeatures(k,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}),m=f.call([{methodname:"mod_treasurehunt_update_riddles",args:{riddles:l,treasurehuntid:e,lockid:i}}]);m[0].done(function(d){if(console.log(d),d.status.code)b.alert("Error",d.status.msg,"Continue");else{var e;a.forEachFeature(function(a){e=c.getFeatureById(a.getId()),e.setProperties(a.getProperties()),e.setGeometry(a.getGeometry())}),a.clear(),E(),Z=!1,"function"==typeof g&&h instanceof Array&&g.apply(null,h)}}).fail(function(a){console.log(a),b.alert("Error",a.message,"Continue")})}function R(a){return a?"addClass":"removeClass"}var S,T,U,V,W={roads:{}},X=new d.source.Vector({projection:"EPSG:3857"}),Y=new d.source.Vector({projection:"EPSG:3857"}),Z=!1,$={},_=1,aa=new d.layer.Vector({source:new d.source.Vector({projection:"EPSG:3857"})}),ba=g.createGeocoder("openstreetmap");a("#controlPanel").addClass("ui-widget-header ui-corner-all"),a("#riddleListPanel_global").addClass(".ui-widget-content ui-corner-all"),a('<span id="edition"/>').appendTo(a("#controlPanel")),a('<input type="radio" name="controlPanel" id="radio1" value="add">').appendTo(a("#edition")),a("<label>").attr("for","radio1").text("Anadir").appendTo(a("#edition")),a('<input type="radio" name="controlPanel" id="radio2" value="modify">').appendTo(a("#edition")),a("<label>").attr("for","radio2").text("Modificar").appendTo(a("#edition")),a('<button id="saveRiddle"/>').attr("disabled",!0).text("Guardar cambios").appendTo(a("#controlPanel")),a('<button id="removeFeature"/>').attr("disabled",!0).text("Eliminar").appendTo(a("#controlPanel")),a('<div id="searchContainer">').appendTo(a("#controlPanel")),a('<input id="searchAddress" type="search" placeholder="Enter a Location" class="clearable"/>').appendTo(a("#searchContainer")),a('<span id="searchIcon" class="ui-icon  ui-icon-search"></span>').appendTo(a("#searchContainer")),a('<button id="addRiddle"/>').text("Riddle").prependTo(a("#controlPanel")),a('<button id="addRoad"/>').text("Road").prependTo(a("#controlPanel")),a("#radio1").button({text:!1,icons:{primary:"ui-icon-plusthick"}}),a("#radio2").button({text:!1,icons:{primary:"ui-icon-pencil"}}),a("#removeFeature").button({text:!1,icons:{primary:"ui-icon-trash"}}),a("#saveRiddle").button({text:!1,icons:{primary:"ui-icon-disk"}}),a("#addRiddle").button({icons:{primary:"ui-icon-circle-plus"}}),a("#addRoad").button({icons:{primary:"ui-icon-circle-plus"}}),a("#edition").buttonset(),a('<ul id="riddleList"/>').appendTo(a("#riddleListPanel")),a("#riddleList").sortable({handle:".handle",tolerance:"pointer",zIndex:9999,opacity:.5,forcePlaceholderSize:!0,cursorAt:{top:-7},cursor:"n-resize",axis:"y",items:"li:not(:hidden , .blocked)",helper:"clone",start:function(b,c){var d=c.item.attr("roadid"),e=c.item.index('li[roadid="'+d+'"]');c.item.data("start_pos",e);var f=a(this).data("ui-sortable").scrollParent,g=f[0].scrollHeight-f[0].clientHeight-c.helper.height();a(this).data("maxScrollTop",g)},sort:function(b,c){var d=a(this).data("ui-sortable").scrollParent,e=a(this).data("maxScrollTop");d.scrollTop()>e&&d.scrollTop(e)},update:function(b,c){var d,e=c.item.data("start_pos"),f=c.item.attr("roadid"),g=c.item.index('li[roadid="'+f+'"]'),h=a(this).children('li[roadid="'+f+'"]'),i=a(h).length;if(e!==g){if(g>e)for(d=e;g>=d;d++)j(h,i,d,X,Y,W.roads[f].vector);else for(d=g;e>=d;d++)j(h,i,d,X,Y,W.roads[f].vector);D(),Z=!0}}}).disableSelection(),a('<ul id="roadList"/>').appendTo(a("#roadListPanel")),window.app={};var ca=window.app;ca.generateResizableControl=function(a){var b=a||{},c=document.createElement("button");c.innerHTML="<>",c.id="egrip";var e=document.createElement("div");e.className="ol-control ol-unselectable egrip-container",e.appendChild(c),d.control.Control.call(this,{element:e,target:b.target})},d.inherits(ca.generateResizableControl,d.control.Control);var da=new d.style.Style({fill:new d.style.Fill({color:"rgba(0, 0, 0, 0.1)"}),stroke:new d.style.Stroke({color:"#6C0492",width:2}),image:new d.style.Circle({radius:5,fill:new d.style.Fill({color:"#ffcc33"}),stroke:new d.style.Stroke({color:"#000000",width:2})}),text:new d.style.Text({textAlign:"center",scale:1.3,fill:new d.style.Fill({color:"#fff"}),stroke:new d.style.Stroke({color:"#6C0492",width:3.5})})}),ea=new d.style.Style({fill:new d.style.Fill({color:"rgba(0, 0, 0, 0.05)"}),stroke:new d.style.Stroke({color:"#FAC30B",width:2}),image:new d.style.Circle({radius:5,fill:new d.style.Fill({color:"#ffcc33"}),stroke:new d.style.Stroke({color:"#000000",width:2})}),text:new d.style.Text({textAlign:"center",scale:1.3,fill:new d.style.Fill({color:"#fff"}),stroke:new d.style.Stroke({color:"#ffcc33",width:3.5})}),zIndex:"Infinity"}),fa=new d.layer.Vector({source:new d.source.Vector({projection:"EPSG:3857"}),visible:!1}),ga=new d.Map({layers:[new d.layer.Tile({source:new d.source.OSM}),fa],renderer:"canvas",target:"map",view:new d.View({center:new d.proj.transform([-4.715354,41.654618],"EPSG:4326","EPSG:3857"),zoom:12,minZoom:2}),controls:d.control.defaults().extend([new ca.generateResizableControl({target:document.getElementById("riddleListPanel_global")})])});a("#riddleListPanel_global").resizable({handles:{e:a("#egrip")},resize:function(a,b){b.size.height=b.originalSize.height},cancel:""});var ha={init:function(){this.select=new d.interaction.Select({filter:function(a){return $[a.getId()]?!0:!1},style:function(a){var b=new d.style.Fill({color:"rgba(255,255,255,0.4)"}),c=new d.style.Stroke({color:"#3399CC",width:2}),e=[new d.style.Style({image:new d.style.Circle({fill:b,stroke:c,radius:5}),fill:b,stroke:c,text:new d.style.Text({text:""+a.get("noriddle"),textAlign:"center",scale:1.3,fill:new d.style.Fill({color:"#fff"}),stroke:new d.style.Stroke({color:"#3399CC",width:3.5})}),zIndex:"Infinity"})];return e}}),ga.addInteraction(this.select),this.modify=new d.interaction.Modify({features:this.select.getFeatures(),style:new d.style.Style({image:new d.style.Circle({radius:5,fill:new d.style.Fill({color:"#3399CC"}),stroke:new d.style.Stroke({color:"#000000",width:2})})}),deleteCondition:function(a){return d.events.condition.shiftKeyOnly(a)&&d.events.condition.singleClick(a)}}),ga.addInteraction(this.modify),this.setEvents()},setEvents:function(){V=this.select.getFeatures(),this.select.on("change:active",function(){V.clear(),y()}),this.select.on("select",function(){V.getLength()>0?x():y()}),this.modify.on("modifyend",function(a){D(),l(a.features,Y,X,W.roads[T].vector),Z=!0})},getActive:function(){return this.select.getActive()&&this.modify.getActive()?!0:!1},setActive:function(a){this.select.setActive(a),this.modify.setActive(a)}};ha.init();var ia={init:function(){ga.addInteraction(this.Polygon),this.Polygon.setActive(!1),this.setEvents()},Polygon:new d.interaction.Draw({source:fa.getSource(),type:"Polygon",style:new d.style.Style({fill:new d.style.Fill({color:"rgba(0, 0, 0, 0.05)"}),stroke:new d.style.Stroke({color:"#FAC30B",width:2}),image:new d.style.Circle({radius:5,fill:new d.style.Fill({color:"#ffcc33"}),stroke:new d.style.Stroke({color:"#000000",width:2})}),zIndex:"Infinity"})}),setEvents:function(){this.Polygon.on("drawend",function(a){a.feature.setProperties({roadid:T,riddleid:U,noriddle:S}),$[_]=!0,a.feature.setId(_),_++,W.roads[T].vector.getSource().addFeature(a.feature),k(a.feature,Y,X),fa.getSource().clear(),D(),Z=!0})},getActive:function(){return this.Polygon.getActive()},setActive:function(a){a?this.Polygon.setActive(!0):this.Polygon.setActive(!1),ga.getTargetElement().style.cursor=a?"none":""}};a(document).keyup(function(a){27===a.keyCode&&ia.Polygon.abortDrawing_()}),ia.init(),ia.setActive(!1),ha.setActive(!1),B();var ja=new d.interaction.Snap({source:fa.getSource()});ga.addInteraction(ja),o(e),a("<div id='dialogalert' title='Error'>"+h.empty_ridle+"</div>").appendTo(a("#riddleList")),a("#dialogalert").dialog({maxHeight:500,autoOpen:!1}),a("#searchAddress").autocomplete({minLength:4,source:function(a,b){var c=a.term;ba.geocode(c,function(a){if(!a[0])return void b();for(var c=[],d=0,e=a.length;e>d;d++){var f,g;f=a[d].getLatitude(),g=a[d].getLongitude();var h={value:a[d].totalName,latitude:f,longitude:g,boundingbox:a[d].boundingbox};c[d]=h}b(c)})},select:function(a,b){if(b.item.boundingbox){var c=[];c[0]=parseFloat(b.item.boundingbox[2]),c[1]=parseFloat(b.item.boundingbox[0]),c[2]=parseFloat(b.item.boundingbox[3]),c[3]=parseFloat(b.item.boundingbox[1]),c=d.proj.transformExtent(c,"EPSG:4326","EPSG:3857"),F(ga,c)}else{var e=d.proj.fromLonLat([b.item.longitude,b.item.latitude]);G(ga,e)}},autoFocus:!0,position:{my:"left top",at:"left bottom",collision:"fit"}}).on("click",function(){a(this).autocomplete("search",a(this).value)}),a("#addRiddle").on("click",function(){Z?Q(X,Y,e,L,[T,c],i):L(T,c)}),a("#addRoad").on("click",function(){Z?Q(X,Y,e,N,[c],i):N(c)}),a("#removeFeature").on("click",function(){b.confirm("Estas seguro?","Si la eliminas ya no podras recuperarla","Confirmar","Cancelar",function(){m(V,Y,X,W.roads[T].vector),p(V,W.roads[T].vector),y(),D(),Z=!0})}),a("#saveRiddle").on("click",function(){Q(X,Y,e,null,null,i)}),a("#riddleList").on("click",".ui-icon-info, .ui-icon-alert",function(){var b=a(this).data("id");a(b).dialog("open"),a(".ui-dialog :button").blur()}),a("#riddleList").on("click",".ui-icon-trash",function(){var c=a(this).parents("li");b.confirm("Estas seguro?","Si la eliminas ya no podras recuperarla","Confirmar","Cancelar",function(){var a=parseInt(c.attr("riddleid"));P(a,X,Y,W.roads[T].vector,e,i)})}),a("#riddleList").on("click",".ui-icon-pencil",function(){var b=parseInt(a(this).parents("li").attr("riddleid"));Z?Q(X,Y,e,K,[b,c],i):K(b,c)}),a("input[name=controlPanel]:radio").on("click",function(){"true"===a(this).attr("previousValue")?a(this).attr("checked",!1).button("refresh"):a("input[name=controlPanel]:radio").attr("previousValue",!1),a(this).attr("previousValue",a(this).is(":checked"));var b=a("input[type='radio'][name='controlPanel']:checked"),c=b.val();"add"===c?(ia.setActive(!0),ha.setActive(!1)):"modify"===c?(ia.setActive(!1),ha.setActive(!0)):(ia.setActive(!1),ha.setActive(!1))}),a("#riddleList").on("click","li",function(b){return a(b.target).is(".handle ,.nohandle, .ui-icon , .sortable-number")?void b.preventDefault():(a(this).addClass("ui-selected").siblings().removeClass("ui-selected"),S=parseInt(a(this).attr("noriddle")),U=parseInt(a(this).attr("riddleid")),I(W.roads[T].vector,aa,U,V,X,Y),C(),void ia.Polygon.abortDrawing_())}),a("#roadList").on("click","li",function(b){return a(b.target).is(".handle , .ui-icon")?void b.preventDefault():(a(this).addClass("ui-selected").siblings().removeClass("ui-selected"),$={},ia.Polygon.abortDrawing_(),T=a(this).attr("roadid"),parseInt(a(this).attr("blocked"))?A():z(),H(T,W.roads[T].vector,ga),void B())}),a("#roadList").on("click",".ui-icon-pencil",function(){var b=parseInt(a(this).parents("li").attr("roadid"));Z?Q(X,Y,e,M,[b,c],i):M(b,c)}),a("#roadList").on("click",".ui-icon-trash",function(){var c=a(this).parents("li");b.confirm("Estas seguro?","Si la eliminas se eliminaran todas las pitas asociadas y ya no podras recuperarlas","Confirmar","Cancelar",function(){var a=parseInt(c.attr("roadid"));O(a,X,Y,e,i)})}),ga.on("pointermove",function(a){if(!a.dragging&&!ia.getActive()&&ha.getActive()){var b=ga.getEventPixel(a.originalEvent),c=ga.forEachFeatureAtPixel(b,function(a,b){if($[a.getId()]){var c=!1;return V.forEach(function(b){a===b&&(c=!0)}),c?!1:!0}return!1});ga.getTargetElement().style.cursor=c?"pointer":""}}),a(document).on("touchend",".ui-dialog-titlebar-close",function(){a(this).parent().siblings(".ui-dialog-content").dialog("close")}),a(document).on("input",".clearable",function(){a(this)[R(this.value)]("x")}).on("mousemove",".x",function(b){a(this)[R(this.offsetWidth-18<b.clientX-this.getBoundingClientRect().left)]("onX")}).on("touchstart click",".onX",function(b){b.preventDefault(),a(this).removeClass("x onX").val("").change().autocomplete("close")}),window.onbeforeunload=function(a){var b="No ha guardado los cambios realizados.",a=a||window.event;return Z?(a&&(a.returnValue=b),b):void 0}}};return i});
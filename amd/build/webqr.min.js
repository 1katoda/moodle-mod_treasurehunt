"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}define(["jquery","core/notification","core/str","mod_treasurehunt/instascan"],function(c,s,i,o){var r=-1,a=null,d=null;return{getDetectedCameras:function(){return a},setup:function(){},enableTest:function(t){var e,n=this,i={};document.cookie.split(";").forEach(function(e){var t=e.split("=");t[1]&&(i[t[0].trim()]=t[1].trim())}),"Done"!=i.QRScanPassed?(e=function(e){document.cookie="QRScanPassed = Done",this.unloadQR(function(){c("#QRStatusDiv").html(t)})}.bind(this),c("#idbuttonnextcam").click(function(){return n.setnextwebcam(n.testFormReport.bind(n))}),this.loadQR(e,this.testFormReport.bind(this))):c("#QRStatusDiv").html(t)},testFormReport:function(e){var t,n,i,o,a,r;"string"==typeof e?(c("#QRvalue").text(e),c("#previewQR").hide()):"object"===_typeof(e)&&("NotAllowedError"==e.name||0==e.code?(s.addNotification({message:c("#errorQR").text(),type:"error"}),c("#previewQR").hide(),c("#QRStatusDiv").hide()):((i=(n=(t=c("#previewQRvideo")).closest("div")).width())/(o=n.height())<t.width()/t.height()?t.width(i):t.height(o),t.css("display","block"),a=e.camera,null!==e.cameras[a].name&&c("#QRvalue").text(e.cameras[a].name),c("#previewQR").show(),(r=this.getnextwebCam())!=a?(null!==e.cameras[r].name&&c("#idbuttonnextcam").text(r+":"+e.cameras[r].name),c("#idbuttonnextcam").show()):c("#idbuttonnextcam").hide()))},enableEditForm:function(){var e=this;c("#id_generateQR").click(this.handleGenerateQR.bind(this)),c("#id_stopQR").click(this.handleStopQR.bind(this)),c("#id_scanQR").click(this.handleScanEditStage.bind(this)),c("#idbuttonnextcam").click(function(){return e.setnextwebcam(e.editFormReport.bind(e))})},handleGenerateQR:function(){var e,t=c("#id_qrtext").val();return""!=t?(e="https://chart.googleapis.com/chart?cht=qr&chs=500x500&chl="+c("#id_qrtext").val(),c("#outQRCode").text(""),c("#outQRCode").prepend(c("<img>",{id:"theQRImg",src:e,width:"150px",align:"left",title:t}))):c("#QRStatusDiv").text("Enter text in QRText field."),!1}.bind(this),handleStopQR:function(){return this.unloadQR(),c("#QRvalue").text(""),c("#previewQR").hide(),c("#id_stopQR").hide(),c("#id_scanQR").show(),!1},handleScanEditStage:function(){return this.loadQR(function(e){c("#id_qrtext").val(e),this.unloadQR(),c("#QRvalue").text(""),c("#id_stopQR").hide(),c("#id_scanQR").show(),c("#previewQR").hide()}.bind(this),this.editFormReport.bind(this)),c("#previewQR").show(),c("#previewQRdiv").show(),c("#id_stopQR").show(),c("#id_scanQR").hide(),!1},editFormReport:function(e){var t,n;"string"==typeof e?(c("#QRvalue").text(e),c("#id_stopQR").hide(),c("#id_scanQR").show(),c("#previewQRdiv").hide(),c("#idbuttonnextcam").hide()):"object"===_typeof(e)&&(0==e.code?(i.get_string("warnqrscannererror","treasurehunt"),c("#outQRCode").text("Camera access error!")):(t=e.camera,c("#QRvalue").text(t+":"+e.cameras[t].name),(n=(t+1)%e.cameras.length)!=t?(c("#idbuttonnextcam").text(n+":"+e.cameras[n].name),c("#idbuttonnextcam").show()):c("#idbuttonnextcam").hide()))},unloadQR:function(e){void 0!==d&&(d.stop().then(function(){console.info("camera stopped")}),r=-1,c("#previewQRvideo").hide(),"function"==typeof e&&e(""))},loadQR:function(e,t){var n=c("#previewQRvideo");n.show(),(d=new o.Scanner({video:n.get(0),mirror:!1})).addListener("scan",e),o.Camera.getCameras().then(function(e){0<(a=e).length?(r=0,d.start(a[r]).then(function(){t({camera:r,cameras:a})}).catch(function(e){t(e)})):console.error("No cameras found.")}).catch(function(e){t(e)})},getnextwebCam:function(){return null===a||-1===r?0:(r+1)%a.length},getbackCam:function(){var e=this.getnextwebCam();if(null!==a&&1<a.length)for(var t=0;t<a.length;t++)null!==a[t].name&&-1!=a[t].name.toLowerCase().indexOf("back")&&(e=t);return e},setnextwebcam:function(t){var n=this.getnextwebCam();if(r!=n)if(null!==a)try{this.selectCamera(a,n,t)}catch(e){console.error(e),t(e.message)}else o.Camera.getCameras().then(function(e){this.selectCamera(e,n,t)}).catch(function(e){console.error(e),t(e.message)})},selectCamera:function(o,e,a){if(0<o.length){if(-1==r&&1<o.length)for(var t=0;t<o.length;t++)null!==o[t].name&&-1!=o[t].name.toLowerCase().indexOf("back")&&(e=t);r=e,d.start(o[r]).then(function(){var e=c("#previewQRvideo"),t=e.closest("div"),n=t.width(),i=t.height();n/i<e.width()/e.height()?e.width(n):e.height(i),e.css("display","block"),a({camera:r,cameras:o})}).catch(function(e){d.stop(),console.error(e),a("Error activating camera: "+e.message)})}else console.error("No cameras found."),a("No cameras found.")}}});
//# sourceMappingURL=webqr.min.js.map
